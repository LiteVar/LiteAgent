import{r,j as s,b3 as K,b4 as D,b5 as P}from"./index-Bqd9ntWg.js";import{U as o}from"./User-CUv3sm6S.js";import{s as f}from"./index-D_2ZsiUY.js";import{M as q,R as Z}from"./index-BIpk_xcc.js";import{B as R}from"./button-w-BhhqNe.js";import{S as w}from"./index-CO55h4Px.js";import{I as O,R as z}from"./ResponseCode-DASChpIM.js";import{T as $}from"./index-Bm_C5b8n.js";import{u as L,m as Q}from"./query.gen-DycqmmC7.js";import{u as G,a as H}from"./workspaceContext-DM4ldxn7.js";import{a as J}from"./LeftOutlined-SuJsU2gG.js";import{F as X}from"./Table-C55P5jUG.js";import{D as Y}from"./index-CVmKX9-z.js";import"./render-CvJz5-Mq.js";import"./asyncToGenerator-C_d2R9__.js";import"./useZIndex-CxNEmHgd.js";import"./EllipsisOutlined-DJ-lU4UH.js";import"./compact-item-BLNrSCAv.js";import"./index-C81jIois.js";import"./move-C6Ql-cRB.js";import"./useBreakpoint-HDRcWJZe.js";import"./index-WUPub_KU.js";import"./index-DdR5j2rt.js";import"./index-BWmRGx5f.js";const{Option:T}=w,ee=({visible:u,onCancel:N,onOk:E})=>{const[i,j]=r.useState([]),[x,g]=r.useState(""),[k,v]=r.useState(o.Normal),[I,e]=r.useState(""),p=a=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a),y=a=>{g(a.target.value),e("")},b=()=>{const a=x.split(/[\s,]+/).filter(m=>m.trim()!==""),c=[],h=[];a.forEach(m=>{p(m)&&!i.includes(m)?c.push(m):p(m)||h.push(m)}),h.length>0?e(`以下邮箱格式无效: ${h.join(", ")}`):e(""),c.length>0&&(j([...i,...c]),g(""))},d=a=>{const c=i.filter(h=>h!==a);j(c)},C=a=>{v(a)},V=r.useCallback(()=>{if(i.length===0){f.error("请输入至少一个有效的邮箱地址");return}E(i,k),j([]),g(""),v(o.Normal),e("")},[i,k,E]);return s.jsxs(q,{centered:!0,title:"添加成员",open:u,onCancel:N,footer:[s.jsx(R,{onClick:N,children:"取消"},"cancel"),s.jsx(R,{type:"primary",onClick:V,children:"添加"},"submit")],children:[s.jsxs("div",{className:"mt-8 mb-2",children:[s.jsxs(w,{className:"w-full",value:k,onChange:C,children:[s.jsx(T,{value:o.Normal,children:"权限：普通成员"}),s.jsx(T,{value:o.Developer,children:"权限：开发者"})]}),s.jsx("div",{className:"mt-3",children:s.jsx(O,{value:x,onChange:y,onBlur:b,onPressEnter:a=>{a.preventDefault(),b()},placeholder:"输入成员的邮箱账号进行添加，按 Enter 键确认"})}),I&&s.jsx("div",{style:{color:"red",marginTop:4},children:I})]}),s.jsx("div",{style:{marginBottom:16},children:i.map(a=>s.jsx($,{closable:!0,onClose:()=>d(a),style:{marginBottom:8},children:a},a))}),s.jsx("div",{style:{marginTop:16,color:"rgba(0,0,0,0.45)",fontSize:14},children:"如果成员的邮箱账号未注册，系统将发送激活邮件到该成员邮箱"})]})};function Me(){var W,A,B;const[u,N]=r.useState(""),[E,i]=r.useState(""),[j,x]=r.useState(!1),[g,k]=r.useState(0),[v,I]=r.useState(10),e=G(),p=H(),y=r.useMemo(()=>{if(e)return Number(e==null?void 0:e.role)===o.Admin},[e]),b=r.useCallback(t=>t===(p==null?void 0:p.id),[p]),{data:d,refetch:C}=L({...Q({query:{pageNo:g,pageSize:v,username:E},headers:{"Workspace-id":(e==null?void 0:e.id)||""}})}),V=()=>{x(!0)},a=()=>{x(!1)},c=r.useCallback(()=>{i(u)},[u]),h=r.useCallback(async(t,l)=>{var S,M;const n=await K({query:{emails:t.join(","),role:l},headers:{"Workspace-id":(e==null?void 0:e.id)||""}});((S=n==null?void 0:n.data)==null?void 0:S.code)===z.S_OK?f.success("邀请成功"):f.error((M=n==null?void 0:n.data)==null?void 0:M.message),x(!1)},[e]),m=r.useCallback(async(t,l)=>{t.key==="delete"?(await D({path:{memberId:l},headers:{"Workspace-id":(e==null?void 0:e.id)||""}}),f.success("删除成功")):t.key==="quit"?q.confirm({title:"退出工作空间",content:"在工作空间中的创建的agent聊天对话、agent、工具之类都会被删除",onOk:async()=>{var S,M;const n=await D({path:{memberId:l},headers:{"Workspace-id":(e==null?void 0:e.id)||""}});((S=n==null?void 0:n.data)==null?void 0:S.code)===z.S_OK?(f.success("删除成功"),await C()):f.error((M=n==null?void 0:n.data)==null?void 0:M.message)}}):(await P({path:{memberId:l},query:{role:t.key},headers:{"Workspace-id":(e==null?void 0:e.id)||""}}),f.success("修改成功")),await C()},[e,C]),_=r.useCallback(t=>b(t)&&!y?[{key:"quit",label:"退出",danger:!0}]:[{key:o.Normal,label:"设置为普通成员"},{key:o.Developer,label:"设置为开发者"},{key:"delete",label:"删除",danger:!0}],[e,b,y]),F=[{title:"成员名称",dataIndex:"name",key:"name"},{title:"成员信息",dataIndex:"email",key:"email"},{title:"成员权限",key:"role",render:(t,l)=>s.jsx(s.Fragment,{children:y||b(l.userId)?s.jsx(Y,{menu:{items:_(l.userId),onClick:n=>m(n,l.id)},disabled:l.role===o.Admin,children:s.jsx(R,{className:"-ml-4",children:U(l.role)})}):s.jsx("span",{children:U(l.role)})})}];return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"成员管理"}),s.jsx(O,{placeholder:"搜索",prefix:s.jsx(J,{onClick:c}),style:{width:300},value:u,onKeyDown:t=>t.key==="Enter"&&c(),onChange:t=>N(t.target.value)}),y?s.jsx(R,{type:"primary",icon:s.jsx(Z,{}),onClick:V,children:"添加成员"}):s.jsx("span",{})]}),s.jsx(X,{columns:F,dataSource:(A=(W=d==null?void 0:d.data)==null?void 0:W.list)==null?void 0:A.map(t=>({...t,key:t.id})),pagination:{current:g+1,pageSize:v,total:Number(((B=d==null?void 0:d.data)==null?void 0:B.total)||10),onChange:(t,l)=>{k(t-1),I(l)}}}),s.jsx(ee,{visible:j,onCancel:a,onOk:h})]})}const U=u=>{switch(u){case o.Normal:return"普通成员";case o.Developer:return"开发者";case o.Admin:return"管理员";default:return"未知角色"}};export{Me as default};
