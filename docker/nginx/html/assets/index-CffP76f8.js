import{r,_ as H,j as e,S as _,aP as G,aQ as X,aR as Z}from"./index-Bqd9ntWg.js";import{F as d}from"./index-BesF1Zzs.js";import{M as B,R as D}from"./index-BIpk_xcc.js";import{I as v,R as ee}from"./ResponseCode-DASChpIM.js";import{S as j}from"./index-CO55h4Px.js";import{S as se}from"./index-js1QsEy5.js";import{P as L,D as O}from"./index-D2KebkZD.js";import{I as ae}from"./asyncToGenerator-C_d2R9__.js";import{B as w}from"./button-w-BhhqNe.js";import{u as J,l as le,i as re}from"./query.gen-DycqmmC7.js";import{T as ne}from"./index-BQcgMSUo.js";import{p as te}from"./avatar-DGIiPYzy.js";import{u as ie}from"./workspaceContext-DM4ldxn7.js";import{U as ce}from"./User-CUv3sm6S.js";import{s as T}from"./index-D_2ZsiUY.js";import{a as de}from"./LeftOutlined-SuJsU2gG.js";import{T as oe}from"./index-Bua754-M.js";import{C as me}from"./index-Cvh1Rscw.js";import{I as he}from"./index-BjgghHgF.js";import{T as pe}from"./index-Bm_C5b8n.js";import{E as xe}from"./index-C81jIois.js";import"./useZIndex-CxNEmHgd.js";import"./compact-item-BLNrSCAv.js";import"./render-CvJz5-Mq.js";import"./EllipsisOutlined-DJ-lU4UH.js";import"./move-C6Ql-cRB.js";import"./useBreakpoint-HDRcWJZe.js";import"./SwapOutlined-BPIwuBYF.js";var ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},fe=function(m,h){return r.createElement(ae,H({},m,{ref:h,icon:ue}))},je=r.forwardRef(fe),y=(n=>(n[n.OPEN_API3=1]="OPEN_API3",n[n.JSON_RPC=2]="JSON_RPC",n[n.OPEN_MODBUS=3]="OPEN_MODBUS",n))(y||{});const{TextArea:K}=v,ye=n=>{const{visible:m,onCancel:h,onOk:i,onDelete:p,initialData:l}=n,[c]=d.useForm(),[o,x]=r.useState(!1);r.useEffect(()=>{l!=null&&l.id?(c.setFieldsValue(l),x(!0)):(c.resetFields(),x(!1))},[l,c]);const s=r.useCallback(async()=>{try{c.validateFields().then(async u=>{await i(l==null?void 0:l.id,u)&&c.resetFields()})}catch(u){console.error("Validation failed:",u)}},[c,i,l]),b=()=>{l!=null&&l.id&&p&&p(l.id)};return e.jsxs(B,{centered:!0,title:o?"编辑工具":"新建工具",open:m,onCancel:h,onOk:s,okText:"确定",cancelText:"取消",width:600,children:[e.jsxs(d,{form:c,layout:"vertical",children:[e.jsx(d.Item,{name:"name",label:"工具名称",rules:[{required:!0,message:"请输入工具名称",whitespace:!0}],children:e.jsx(v,{maxLength:20,placeholder:"请输入工具名称"})}),e.jsx(d.Item,{name:"description",label:"描述",children:e.jsx(K,{maxLength:300,rows:4,placeholder:"用简单几句话将工具介绍给用户"})}),e.jsxs(d.Item,{label:"Schema",children:[e.jsx(d.Item,{label:"类型",name:"schemaType",rules:[{required:!0,message:"请选择类型"}],style:{display:"inline-block",width:"calc(30% - 8px)",marginRight:"8px"},children:e.jsxs(j,{placeholder:"这里显示协议类型",children:[e.jsx(j.Option,{value:y.OPEN_API3,children:"OpenAPI3(YAML/JSON)"}),e.jsx(j.Option,{value:y.JSON_RPC,children:"OpenRPC(JSON)"}),e.jsx(j.Option,{value:y.OPEN_MODBUS,children:"OpenModbus(JSON)"})]})}),e.jsx(d.Item,{label:"文稿",name:"schemaStr",rules:[{required:!0,message:"请输入schema文稿"}],style:{display:"inline-block",width:"calc(70%)"},children:e.jsx(K,{rows:4,maxLength:2e4,placeholder:"请输入schema文稿"})})]}),e.jsxs(d.Item,{label:"API Key",children:[e.jsx(d.Item,{label:"认证类型",name:"apiKeyType",style:{display:"inline-block",width:"calc(30% - 8px)",marginRight:"8px"},children:e.jsxs(j,{placeholder:"这里显示Key类型",children:[e.jsx(j.Option,{value:"Basic",children:"Basic"}),e.jsx(j.Option,{value:"Bearer",children:"Bearer"})]})}),e.jsx(d.Item,{label:"Key值",name:"apiKey",style:{display:"inline-block",width:"calc(70%)"},children:e.jsx(v,{maxLength:150,placeholder:"请输入API Key"})})]}),e.jsx(d.Item,{name:"shareFlag",label:"分享设置",valuePropName:"checked",extra:e.jsx("span",{className:"ml-2",children:"开启后其他成员可以查看并使用此工具"}),children:e.jsx(se,{checkedChildren:"开启",unCheckedChildren:"关闭"})})]}),o&&p&&(l==null?void 0:l.canDelete)&&e.jsx(L,{title:"确认删除",icon:e.jsx(je,{style:{color:"red"}}),description:"即将删除工具的所有信息，确认删除？",onConfirm:b,okText:"确认",cancelText:"取消",children:e.jsx(w,{danger:!0,style:{float:"left"},children:"删除"})})]})},{Title:be,Paragraph:k}=ne,ge=n=>{const{visible:m,onClose:h,toolInfo:i,deleteTool:p,showEditingToolModal:l}=n,c=i==null?void 0:i.id,{data:o,isLoading:x}=J({...le({path:{id:c}}),enabled:m&&!!c}),s=o==null?void 0:o.data,b=r.useCallback(()=>{l({...s,...i}),h()},[s,l,i]),u=r.useCallback(async()=>{await p(c),h()},[s,p]);return e.jsxs(B,{centered:!0,open:m,onCancel:h,footer:null,width:600,children:[x&&e.jsx(_,{}),!!s&&e.jsxs(e.Fragment,{children:[e.jsx(be,{level:4,className:"center",children:s==null?void 0:s.name}),e.jsx(k,{children:s==null?void 0:s.description}),e.jsxs(O,{column:1,className:"mb-4",children:[e.jsx(O.Item,{label:"schema类型",children:(s==null?void 0:s.schemaType)===y.OPEN_API3?"OpenAPI3(YAML/JSON)":(s==null?void 0:s.schemaType)===y.JSON_RPC?"OpenRPC(JSON)":(s==null?void 0:s.schemaType)===y.OPEN_MODBUS?"OpenModbus(JSON)":""}),e.jsx(O.Item,{label:"schema文稿",children:e.jsx(k,{ellipsis:{rows:3,expandable:!0,symbol:"展开"},style:{maxHeight:500,overflowY:"auto"},children:s==null?void 0:s.schemaStr})}),(s==null?void 0:s.apiKeyType)&&e.jsx(O.Item,{label:"API Key类型",children:s==null?void 0:s.apiKeyType}),(s==null?void 0:s.apiKey)&&e.jsx(O.Item,{label:"API Key值",children:e.jsx(k,{ellipsis:{rows:2,expandable:!0,symbol:"展开"},children:s==null?void 0:s.apiKey})})]}),(i==null?void 0:i.canEdit)&&e.jsx(w,{className:"w-28 mr-4",type:"primary",onClick:b,children:"编辑"}),(i==null?void 0:i.canDelete)&&e.jsx(L,{title:"确认删除",description:"即将删除工具，确认删除？",onConfirm:u,okText:"确认",cancelText:"取消",children:e.jsx(w,{className:"w-28 mb-4",type:"primary",danger:!0,children:"删除"})})]})]})};function He(){const[n,m]=r.useState(""),[h,i]=r.useState(""),[p,l]=r.useState(!1),[c,o]=r.useState(!1),[x,s]=r.useState(void 0),[b,u]=r.useState(void 0),[P,F]=r.useState("0"),t=ie(),{data:C,isLoading:E,refetch:N}=J({...re({query:{name:"",tab:Number(P)},headers:{"Workspace-id":(t==null?void 0:t.id)||""}})}),I=r.useMemo(()=>(C==null?void 0:C.data)||[],[C]),M=r.useMemo(()=>I==null?void 0:I.filter(a=>{var g,f;return((g=a==null?void 0:a.name)==null?void 0:g.toLowerCase().includes(n.toLowerCase()))||((f=a==null?void 0:a.description)==null?void 0:f.toLowerCase().includes(n.toLowerCase()))}),[I,n]),R=r.useCallback(()=>{i(n)},[n]),V=a=>{s(a),l(!0)},U=()=>{l(!1),s(void 0)},W=a=>{u(a),o(!0)},S=r.useCallback(async a=>{await G({path:{id:a},headers:{"Workspace-id":(t==null?void 0:t.id)||""}}),await N()},[t,N]),$=()=>{o(!1),u(void 0)},q=r.useCallback(async(a,g)=>{var A;let f;return a?f=await X({body:{id:a,...g},headers:{"Workspace-id":(t==null?void 0:t.id)||""}}):f=await Z({body:g,headers:{"Workspace-id":(t==null?void 0:t.id)||""}}),((A=f==null?void 0:f.data)==null?void 0:A.code)===ee.S_OK?(await N(),T.success(`${x?"更新":"创建"}工具成功`),l(!1),s(void 0),!0):(T.error("解析失败"),!1)},[x,N,t]),z=r.useCallback(async a=>{await S(a),T.success("删除工具成功"),l(!1),s(void 0)},[S]),Y=[{key:"0",label:"全部"},{key:"1",label:"系统"},{key:"2",label:"来自分享"},{key:"3",label:"我的"}],Q=a=>{F(a)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"工具管理"}),e.jsx(v,{placeholder:"搜索",style:{width:300},value:n,onChange:a=>m(a.target.value),prefix:e.jsx(de,{onClick:R}),onKeyDown:a=>a.key==="Enter"&&R()}),Number(t==null?void 0:t.role)!==ce.Normal&&e.jsx(w,{type:"primary",icon:e.jsx(D,{}),onClick:()=>V(void 0),children:"新建工具"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(oe,{defaultActiveKey:"0",className:"flex-grow",items:Y,onChange:Q})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(a=>e.jsx(me,{className:"hover:shadow-md transition-shadow",onClick:()=>W(a),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{src:te,preview:!1,alt:`${a.name} 图标`,width:40,height:40,className:"mr-4 rounded"}),e.jsx("h3",{className:"text-lg font-semibold m-2",children:a.name})]}),e.jsx("p",{className:"text-gray-500 mt-4 mb-2 line-clamp-3",children:a.description})]}),a.shareTip&&e.jsx(pe,{color:"blue",className:"!mt-2",children:"已分享"})]})},a.id))}),M.length===0&&!E&&e.jsx(xe,{className:"mt-10",description:"暂无数据"}),E&&e.jsx(_,{}),e.jsx(ye,{visible:p,onCancel:U,onOk:q,onDelete:z,initialData:x}),e.jsx(ge,{visible:c,onClose:$,toolInfo:b,deleteTool:S,showEditingToolModal:V})]})}export{He as default};
